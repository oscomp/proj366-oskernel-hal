<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.9/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.9/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.9/dist/index.js"></script><script>((r) => {
          setTimeout(r);
        })(() => {
  const { markmap, mm } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute("style", "position:absolute;bottom:20px;right:20px");
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"OSKernel-HAL","children":[{"content":"Intro","children":[{"content":"\n<p data-lines=\"9,10\">x86_64</p>","children":[{"content":"在 multiboot 的场景下，需要手动调整进入 long mode","children":[],"payload":{"tag":"li","lines":"10,11"}},{"content":"使用 <code>swapgs</code> 指令在用户态和内核态之间切换 <code>gs</code> 段寄存器","children":[],"payload":{"tag":"li","lines":"11,12"}},{"content":"支持复杂的中断和异常处理机制，通过 IDT（中断描述符表）管理","children":[],"payload":{"tag":"li","lines":"12,13"}},{"content":"使用 <code>cpuid</code> 指令获取 CPU 编号","children":[],"payload":{"tag":"li","lines":"13,15"}}],"payload":{"tag":"li","lines":"9,15"}},{"content":"\n<p data-lines=\"15,16\">riscv64</p>","children":[{"content":"在 S 态没有单独获取 hartid 的方法，只能在进入内核的时候存储 Boot 函数传递的信息，在 M 态读取 <code>mhartid</code> 获取 CPU 编号","children":[],"payload":{"tag":"li","lines":"16,17"}},{"content":"使用 <code>tp</code> 寄存器来存储线程局部存储（TLS）指针","children":[],"payload":{"tag":"li","lines":"17,18"}},{"content":"使用 <code>stvec</code> 寄存器来存储陷阱向量的基地址，支持直接模式和向量模式","children":[],"payload":{"tag":"li","lines":"18,20"}}],"payload":{"tag":"li","lines":"15,20"}},{"content":"\n<p data-lines=\"20,21\">aarch64</p>","children":[{"content":"支持 ARMv8-A 架构，包括 AArch64 和 AArch32 两种执行状态","children":[],"payload":{"tag":"li","lines":"21,22"}},{"content":"使用 <code>TPIDR_EL0</code> 寄存器来存储线程局部存储（TLS）指针","children":[],"payload":{"tag":"li","lines":"22,23"}},{"content":"使用 <code>VBAR_EL1</code> 寄存器来存储异常向量表的基地址，支持多种异常类型","children":[],"payload":{"tag":"li","lines":"23,24"}},{"content":"通过读取 <code>MPIDR_EL1</code> 寄存器获取 CPU 编号","children":[],"payload":{"tag":"li","lines":"24,26"}}],"payload":{"tag":"li","lines":"20,26"}},{"content":"\n<p data-lines=\"26,27\">loongarch64</p>","children":[{"content":"使用 Loongson 自主研发的 LoongArch 指令集架构","children":[],"payload":{"tag":"li","lines":"27,28"}},{"content":"使用 <code>$tp</code> 寄存器来存储线程局部存储（TLS）指针","children":[],"payload":{"tag":"li","lines":"28,29"}},{"content":"使用 <code>eentry</code> 寄存器来存储异常入口地址，支持 TLB 缺失异常处理","children":[],"payload":{"tag":"li","lines":"29,30"}},{"content":"支持直接映射模式，通过设置页表项的方式实现内核地址空间的直接映射","children":[],"payload":{"tag":"li","lines":"30,31"}},{"content":"loongarch64 支持很多 SAVE 寄存器，可以帮助在通用寄存器不够的环境下暂存数据。","children":[],"payload":{"tag":"li","lines":"31,32"}},{"content":"通过读取 <code>CPUID</code> 寄存器获取 CPU 编号","children":[],"payload":{"tag":"li","lines":"32,34"}}],"payload":{"tag":"li","lines":"26,34"}}],"payload":{"tag":"h2","lines":"7,8"}},{"content":"Boot","children":[{"content":"\n<p data-lines=\"36,37\">x86_64</p>","children":[{"content":"进入 long mode（64 位模式）","children":[],"payload":{"tag":"li","lines":"37,38"}},{"content":"初始化全局描述符表（GDT）","children":[],"payload":{"tag":"li","lines":"38,39"}},{"content":"初始化中断描述符表（IDT）","children":[],"payload":{"tag":"li","lines":"39,40"}},{"content":"开启分页模式（required）","children":[],"payload":{"tag":"li","lines":"40,42"}}],"payload":{"tag":"li","lines":"36,42"}},{"content":"\n<p data-lines=\"42,43\">riscv64</p>","children":[{"content":"进入 S 态（Supervisor 模式）","children":[],"payload":{"tag":"li","lines":"43,44"}},{"content":"设置 <code>stvec</code> 寄存器为陷阱向量基地址","children":[],"payload":{"tag":"li","lines":"44,45"}},{"content":"初始化页表并开启分页模式","children":[],"payload":{"tag":"li","lines":"45,46"}},{"content":"设置 <code>satp</code> 寄存器为页表基地址","children":[],"payload":{"tag":"li","lines":"46,48"}}],"payload":{"tag":"li","lines":"42,48"}},{"content":"\n<p data-lines=\"48,49\">aarch64</p>","children":[{"content":"进入 EL1（Exception Level 1）","children":[],"payload":{"tag":"li","lines":"49,50"}},{"content":"设置 <code>VBAR_EL1</code> 寄存器为异常向量基地址","children":[],"payload":{"tag":"li","lines":"50,51"}},{"content":"初始化页表并开启分页模式","children":[],"payload":{"tag":"li","lines":"51,52"}},{"content":"设置 <code>TTBR0_EL1</code> 和 <code>TTBR1_EL1</code> 寄存器为页表基地址","children":[],"payload":{"tag":"li","lines":"52,54"}}],"payload":{"tag":"li","lines":"48,54"}},{"content":"\n<p data-lines=\"54,55\">loongarch64</p>","children":[{"content":"支持直接映射模式，通过设置页表项的方式实现内核地址空间的直接映射","children":[],"payload":{"tag":"li","lines":"55,56"}},{"content":"设置 <code>eentry</code> 寄存器为异常入口地址","children":[],"payload":{"tag":"li","lines":"56,57"}},{"content":"初始化页表并开启分页模式","children":[],"payload":{"tag":"li","lines":"57,58"}},{"content":"设置 <code>PGDL</code> 和 <code>PGDH</code> 寄存器为页表基地址","children":[],"payload":{"tag":"li","lines":"58,60"}}],"payload":{"tag":"li","lines":"54,60"}}],"payload":{"tag":"h2","lines":"34,35"}},{"content":"Trap","children":[{"content":"TrapFrame","children":[{"content":"\n<p data-lines=\"64,65\">x86_64</p>","children":[{"content":"包含寄存器状态（如 RAX, RBX, RCX 等）","children":[],"payload":{"tag":"li","lines":"65,66"}},{"content":"包含段寄存器（如 CS, DS, ES 等）","children":[],"payload":{"tag":"li","lines":"66,67"}},{"content":"包含控制寄存器（如 CR2, CR3 等）","children":[],"payload":{"tag":"li","lines":"67,68"}},{"content":"包含标志寄存器（如 RFLAGS）","children":[],"payload":{"tag":"li","lines":"68,69"}},{"content":"包含指令指针（RIP）","children":[],"payload":{"tag":"li","lines":"69,71"}}],"payload":{"tag":"li","lines":"64,71"}},{"content":"\n<p data-lines=\"71,72\">riscv64</p>","children":[{"content":"包含通用寄存器（如 x1, x2, x3 等）","children":[],"payload":{"tag":"li","lines":"72,73"}},{"content":"包含特权级寄存器（如 sstatus, sepc, stval 等）","children":[],"payload":{"tag":"li","lines":"73,74"}},{"content":"包含陷阱原因寄存器（scause）","children":[],"payload":{"tag":"li","lines":"74,75"}},{"content":"包含程序计数器（PC）","children":[],"payload":{"tag":"li","lines":"75,77"}}],"payload":{"tag":"li","lines":"71,77"}},{"content":"\n<p data-lines=\"77,78\">aarch64</p>","children":[{"content":"包含通用寄存器（如 X0, X1, X2 等）","children":[],"payload":{"tag":"li","lines":"78,79"}},{"content":"包含状态寄存器（如 SPSR_EL1）","children":[],"payload":{"tag":"li","lines":"79,80"}},{"content":"包含异常返回地址寄存器（ELR_EL1）","children":[],"payload":{"tag":"li","lines":"80,81"}},{"content":"包含异常级别寄存器（如 ESR_EL1）","children":[],"payload":{"tag":"li","lines":"81,82"}},{"content":"包含程序计数器（PC）","children":[],"payload":{"tag":"li","lines":"82,84"}}],"payload":{"tag":"li","lines":"77,84"}},{"content":"\n<p data-lines=\"84,85\">loongarch64</p>","children":[{"content":"包含通用寄存器（如 R1, R2, R3 等）","children":[],"payload":{"tag":"li","lines":"85,86"}},{"content":"包含状态寄存器（如 CSR_CRMD, CSR_PRMD 等）","children":[],"payload":{"tag":"li","lines":"86,87"}},{"content":"包含异常返回地址寄存器（ERA）","children":[],"payload":{"tag":"li","lines":"87,88"}},{"content":"包含异常原因寄存器（EPC）","children":[],"payload":{"tag":"li","lines":"88,89"}},{"content":"包含程序计数器（PC）","children":[],"payload":{"tag":"li","lines":"89,91"}}],"payload":{"tag":"li","lines":"84,91"}}],"payload":{"tag":"h3","lines":"62,63"}},{"content":"TrapHandler","children":[{"content":"\n<p data-lines=\"93,94\">x86_64</p>","children":[{"content":"使用中断描述符表（IDT）来处理陷阱和中断","children":[],"payload":{"tag":"li","lines":"94,95"}},{"content":"每个中断或陷阱都有一个对应的中断向量，指向一个中断处理程序","children":[],"payload":{"tag":"li","lines":"95,96"}},{"content":"IDT 存储在内存中，并由 <code>lidt</code> 指令加载","children":[],"payload":{"tag":"li","lines":"96,98"}}],"payload":{"tag":"li","lines":"93,98"}},{"content":"\n<p data-lines=\"98,99\">riscv64</p>","children":[{"content":"使用 <code>stvec</code> 寄存器来存储陷阱向量的基地址","children":[],"payload":{"tag":"li","lines":"99,100"}},{"content":"当发生陷阱时，硬件会跳转到 <code>stvec</code> 指定的地址","children":[],"payload":{"tag":"li","lines":"100,101"}},{"content":"<code>stvec</code> 可以配置为直接模式或向量模式","children":[],"payload":{"tag":"li","lines":"101,103"}}],"payload":{"tag":"li","lines":"98,103"}},{"content":"\n<p data-lines=\"103,104\">aarch64</p>","children":[{"content":"使用 <code>VBAR_EL1</code> 寄存器来存储异常向量表的基地址","children":[],"payload":{"tag":"li","lines":"104,105"}},{"content":"当发生异常时，硬件会跳转到 <code>VBAR_EL1</code> 指定的地址","children":[],"payload":{"tag":"li","lines":"105,106"}},{"content":"异常向量表包含不同类型异常的处理程序地址","children":[],"payload":{"tag":"li","lines":"106,108"}}],"payload":{"tag":"li","lines":"103,108"}},{"content":"\n<p data-lines=\"108,109\">loongarch64</p>","children":[{"content":"使用 <code>eentry</code> 寄存器来存储异常入口地址","children":[],"payload":{"tag":"li","lines":"109,110"}},{"content":"使用 <code>tlbrentry</code> 寄存器来存储 TLB 缺失异常的入口地址","children":[],"payload":{"tag":"li","lines":"110,111"}},{"content":"当发生异常时，硬件会跳转到 <code>eentry</code> 或 <code>tlbrentry</code> 指定的地址","children":[],"payload":{"tag":"li","lines":"111,113"}}],"payload":{"tag":"li","lines":"108,113"}}],"payload":{"tag":"h3","lines":"91,92"}}],"payload":{"tag":"h2","lines":"60,61"}},{"content":"IRQ Control","children":[{"content":"\n<p data-lines=\"115,116\">x86_64</p>","children":[{"content":"使用本地高级可编程中断控制器（LAPIC）来管理中断","children":[],"payload":{"tag":"li","lines":"116,117"}},{"content":"使用中断描述符表（IDT）来定义中断向量","children":[],"payload":{"tag":"li","lines":"117,118"}},{"content":"使用 <code>cli</code> 指令来关闭中断","children":[],"payload":{"tag":"li","lines":"118,119"}},{"content":"使用 <code>sti</code> 指令来开启中断","children":[],"payload":{"tag":"li","lines":"119,121"}}],"payload":{"tag":"li","lines":"115,121"}},{"content":"\n<p data-lines=\"121,122\">riscv64</p>","children":[{"content":"使用平台级中断控制器（PLIC）来管理外部中断","children":[],"payload":{"tag":"li","lines":"122,123"}},{"content":"使用 <code>sstatus</code> 寄存器中的 <code>sie</code> 位来控制中断使能","children":[],"payload":{"tag":"li","lines":"123,125"}}],"payload":{"tag":"li","lines":"121,125"}},{"content":"\n<p data-lines=\"125,126\">aarch64</p>","children":[{"content":"使用通用中断控制器（GIC）来管理中断","children":[],"payload":{"tag":"li","lines":"126,127"}},{"content":"使用 <code>DAIF</code> 寄存器中的 <code>DAIFSet</code> 指令来屏蔽中断","children":[],"payload":{"tag":"li","lines":"127,129"}}],"payload":{"tag":"li","lines":"125,129"}},{"content":"\n<p data-lines=\"129,130\">loongarch64</p>","children":[{"content":"使用 <code>estat</code> 寄存器中的 <code>is</code> 位来表示中断状态","children":[],"payload":{"tag":"li","lines":"130,131"}},{"content":"使用 <code>crmd</code> 寄存器中的 <code>ie</code> 位来控制中断使能","children":[],"payload":{"tag":"li","lines":"131,133"}}],"payload":{"tag":"li","lines":"129,133"}}],"payload":{"tag":"h2","lines":"113,114"}},{"content":"CPU Features","children":[{"content":"x86_64","children":[{"content":"支持 SSE、SSE2、SSE3、SSSE3、SSE4.1、SSE4.2、AVX、AVX2、AVX-512 等 SIMD 指令集","children":[],"payload":{"tag":"li","lines":"137,138"}},{"content":"支持 x86 虚拟化技术（Intel VT-x 和 AMD-V）","children":[],"payload":{"tag":"li","lines":"138,139"}},{"content":"支持多核和超线程技术","children":[],"payload":{"tag":"li","lines":"139,140"}},{"content":"支持 64 位扩展（AMD64 和 Intel 64）","children":[],"payload":{"tag":"li","lines":"140,141"}},{"content":"支持硬件加密（AES-NI）","children":[],"payload":{"tag":"li","lines":"141,143"}}],"payload":{"tag":"h3","lines":"135,136"}},{"content":"aarch64","children":[{"content":"支持 ARMv8-A 架构，包括 AArch64 和 AArch32 两种执行状态","children":[],"payload":{"tag":"li","lines":"145,146"}},{"content":"支持 SIMD 指令集（NEON）","children":[],"payload":{"tag":"li","lines":"146,147"}},{"content":"支持硬件虚拟化（ARM Virtualization Extensions）","children":[],"payload":{"tag":"li","lines":"147,148"}},{"content":"支持 TrustZone 安全扩展","children":[],"payload":{"tag":"li","lines":"148,149"}},{"content":"支持硬件加密（Cryptography Extensions）","children":[],"payload":{"tag":"li","lines":"149,151"}}],"payload":{"tag":"h3","lines":"143,144"}},{"content":"riscv64","children":[{"content":"支持 RISC-V 指令集架构（RV64I 基础指令集）","children":[],"payload":{"tag":"li","lines":"153,154"}},{"content":"支持压缩指令集（RVC）","children":[],"payload":{"tag":"li","lines":"154,155"}},{"content":"支持原子指令集（A）","children":[],"payload":{"tag":"li","lines":"155,156"}},{"content":"支持浮点指令集（F 和 D）","children":[],"payload":{"tag":"li","lines":"156,157"}},{"content":"支持硬件虚拟化（H 扩展）","children":[],"payload":{"tag":"li","lines":"157,158"}},{"content":"支持用户自定义扩展","children":[],"payload":{"tag":"li","lines":"158,160"}}],"payload":{"tag":"h3","lines":"151,152"}},{"content":"loongarch64","children":[{"content":"支持 Loongson 自主研发的 LoongArch 指令集架构","children":[],"payload":{"tag":"li","lines":"162,163"}},{"content":"支持 SIMD 指令集（LSX 和 LASX）","children":[],"payload":{"tag":"li","lines":"163,164"}},{"content":"支持硬件虚拟化","children":[],"payload":{"tag":"li","lines":"164,165"}},{"content":"支持多核和超线程技术","children":[],"payload":{"tag":"li","lines":"165,166"}},{"content":"支持硬件加密","children":[],"payload":{"tag":"li","lines":"166,168"}}],"payload":{"tag":"h3","lines":"160,161"}}],"payload":{"tag":"h2","lines":"133,134"}},{"content":"PageTable","children":[{"content":"x86_64","children":[{"content":"4 级页表","children":[],"payload":{"tag":"li","lines":"172,173"}},{"content":"硬件页翻译","children":[],"payload":{"tag":"li","lines":"173,174"}},{"content":"cr4","children":[],"payload":{"tag":"li","lines":"174,176"}}],"payload":{"tag":"h3","lines":"170,171"}},{"content":"aarch64","children":[{"content":"4 级页表","children":[],"payload":{"tag":"li","lines":"178,179"}},{"content":"可配置为三级页表","children":[],"payload":{"tag":"li","lines":"179,180"}},{"content":"硬件页翻译","children":[],"payload":{"tag":"li","lines":"180,181"}},{"content":"TTBR0 (低地址空间)","children":[],"payload":{"tag":"li","lines":"181,182"}},{"content":"TTBR1 (高地址空间)","children":[],"payload":{"tag":"li","lines":"182,184"}}],"payload":{"tag":"h3","lines":"176,177"}},{"content":"riscv64","children":[{"content":"3 级页表（sv39）","children":[],"payload":{"tag":"li","lines":"186,187"}},{"content":"4 级页表（sv48）","children":[],"payload":{"tag":"li","lines":"187,188"}},{"content":"硬件页翻译","children":[],"payload":{"tag":"li","lines":"188,189"}},{"content":"satp","children":[],"payload":{"tag":"li","lines":"189,191"}}],"payload":{"tag":"h3","lines":"184,185"}},{"content":"Loongarch64","children":[{"content":"4 级页表","children":[],"payload":{"tag":"li","lines":"193,194"}},{"content":"页级数可以自由控制","children":[],"payload":{"tag":"li","lines":"194,195"}},{"content":"暂时只支持软件页翻译","children":[{"content":"tlb缺失 异常入口 tlbrentry","children":[],"payload":{"tag":"li","lines":"196,197"}},{"content":"需要根据配置的页级数信息填充","children":[],"payload":{"tag":"li","lines":"197,198"}}],"payload":{"tag":"li","lines":"195,198"}},{"content":"PGDH （高地址空间）","children":[],"payload":{"tag":"li","lines":"198,199"}},{"content":"PGDL （低地址空间）","children":[],"payload":{"tag":"li","lines":"199,201"}}],"payload":{"tag":"h3","lines":"191,192"}}],"payload":{"tag":"h2","lines":"168,169"}},{"content":"Time","children":[{"content":"\n<p data-lines=\"203,204\">x86_64</p>","children":[{"content":"使用本地高级可编程中断控制器（LAPIC）定时器","children":[],"payload":{"tag":"li","lines":"204,205"}},{"content":"使用 <code>rdtsc</code> 指令读取时间戳计数器","children":[],"payload":{"tag":"li","lines":"205,206"}},{"content":"支持高精度事件计时器（HPET）","children":[],"payload":{"tag":"li","lines":"206,208"}}],"payload":{"tag":"li","lines":"203,208"}},{"content":"\n<p data-lines=\"208,209\">riscv64</p>","children":[{"content":"使用 <code>mtime</code> 和 <code>mtimecmp</code> 寄存器进行定时","children":[],"payload":{"tag":"li","lines":"209,210"}},{"content":"设置定时器需要借助 SBI 在 M 态设置","children":[],"payload":{"tag":"li","lines":"210,211"}},{"content":"支持 CLINT（Core Local Interruptor）定时器","children":[],"payload":{"tag":"li","lines":"211,213"}}],"payload":{"tag":"li","lines":"208,213"}},{"content":"\n<p data-lines=\"213,214\">aarch64</p>","children":[{"content":"使用 <code>cntp_ctl</code> 和 <code>cntp_tval</code> 寄存器进行定时","children":[],"payload":{"tag":"li","lines":"214,215"}},{"content":"支持通用定时器框架（Generic Timer Framework）","children":[],"payload":{"tag":"li","lines":"215,216"}},{"content":"支持高精度定时器（CNTVCT_EL0）","children":[],"payload":{"tag":"li","lines":"216,218"}}],"payload":{"tag":"li","lines":"213,218"}},{"content":"\n<p data-lines=\"218,219\">loongarch64</p>","children":[{"content":"使用 <code>tcfg</code> 寄存器进行定时配置","children":[],"payload":{"tag":"li","lines":"219,220"}},{"content":"使用 <code>Time</code> 寄存器读取当前时间","children":[],"payload":{"tag":"li","lines":"220,221"}},{"content":"支持高精度定时器","children":[],"payload":{"tag":"li","lines":"221,223"}}],"payload":{"tag":"li","lines":"218,223"}}],"payload":{"tag":"h2","lines":"201,202"}},{"content":"TLS","children":[{"content":"\n<p data-lines=\"225,226\">x86_64</p>","children":[{"content":"使用 <code>fs</code> 段寄存器来存储线程局部存储（TLS）指针","children":[],"payload":{"tag":"li","lines":"226,227"}},{"content":"通过 <code>wrfsbase</code> 指令设置 TLS 基地址","children":[],"payload":{"tag":"li","lines":"227,229"}}],"payload":{"tag":"li","lines":"225,229"}},{"content":"\n<p data-lines=\"229,230\">riscv64</p>","children":[{"content":"使用 <code>tp</code> 寄存器来存储线程局部存储（TLS）指针","children":[],"payload":{"tag":"li","lines":"230,231"}},{"content":"通过设置 <code>tp</code> 寄存器的值来设置 TLS 基地址","children":[],"payload":{"tag":"li","lines":"231,233"}}],"payload":{"tag":"li","lines":"229,233"}},{"content":"\n<p data-lines=\"233,234\">aarch64</p>","children":[{"content":"使用 <code>TPIDR_EL0</code> 寄存器来存储线程局部存储（TLS）指针","children":[],"payload":{"tag":"li","lines":"234,235"}},{"content":"通过写入 <code>TPIDR_EL0</code> 寄存器来设置 TLS 基地址","children":[],"payload":{"tag":"li","lines":"235,237"}}],"payload":{"tag":"li","lines":"233,237"}},{"content":"\n<p data-lines=\"237,238\">loongarch64</p>","children":[{"content":"使用 <code>$tp</code> 寄存器来存储线程局部存储（TLS）指针","children":[],"payload":{"tag":"li","lines":"238,239"}},{"content":"通过设置 <code>$tp</code> 寄存器的值来设置 TLS 基地址","children":[],"payload":{"tag":"li","lines":"239,241"}}],"payload":{"tag":"li","lines":"237,241"}}],"payload":{"tag":"h2","lines":"223,224"}},{"content":"Percpu","children":[{"content":"\n<p data-lines=\"243,244\">x86_64</p>","children":[{"content":"使用 <code>gs</code> 段寄存器来存储每 CPU 数据的基地址","children":[],"payload":{"tag":"li","lines":"244,245"}},{"content":"通过 <code>wrgsbase</code> 指令设置每 CPU 数据基地址","children":[],"payload":{"tag":"li","lines":"245,246"}},{"content":"使用 <code>swapgs</code> 指令在用户态和内核态之间切换 <code>gs</code> 段寄存器","children":[],"payload":{"tag":"li","lines":"246,248"}}],"payload":{"tag":"li","lines":"243,248"}},{"content":"\n<p data-lines=\"248,249\">riscv64</p>","children":[{"content":"使用 <code>gp</code> 寄存器来存储每 CPU 数据的基地址","children":[],"payload":{"tag":"li","lines":"249,250"}},{"content":"通过设置 <code>gp</code> 寄存器的值来设置每 CPU 数据基地址","children":[],"payload":{"tag":"li","lines":"250,252"}}],"payload":{"tag":"li","lines":"248,252"}},{"content":"\n<p data-lines=\"252,253\">aarch64</p>","children":[{"content":"使用 <code>TPIDR_EL1</code> 寄存器来存储每 CPU 数据的基地址","children":[],"payload":{"tag":"li","lines":"253,254"}},{"content":"通过写入 <code>TPIDR_EL1</code> 寄存器来设置每 CPU 数据基地址","children":[],"payload":{"tag":"li","lines":"254,256"}}],"payload":{"tag":"li","lines":"252,256"}},{"content":"\n<p data-lines=\"256,257\">loongarch64</p>","children":[{"content":"使用 <code>$r21</code> 寄存器来存储每 CPU 数据的基地址","children":[],"payload":{"tag":"li","lines":"257,258"}},{"content":"通过设置 <code>$r21</code> 寄存器的值来设置每 CPU 数据基地址","children":[],"payload":{"tag":"li","lines":"258,259"}}],"payload":{"tag":"li","lines":"256,259"}}],"payload":{"tag":"h2","lines":"241,242"}}]},{"colorFreezeLevel":2,"initialExpandLevel":2})</script>
</body>
</html>
